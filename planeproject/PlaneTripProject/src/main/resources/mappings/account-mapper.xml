<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="AccountDAO">
	<!-- 쿼리 작성 영역 -->
	<!-- 이름 추가 쿼리 -->
	
	<select id="idCheck" parameterType="string" resultType="int">
		select count(EMAIL)
			from user
			where EMAIL = #{email}
	</select>
	
	<insert id="join" parameterType="user">
	<![CDATA[
		insert into user(
			EMAIL,
			PASSWORD,
			LAST_NAME,
			FIRST_NAME,
			FULL_NAME,
			GENDER,
			BIRTHDATE,
			PHONE,
			ADDRESS
		) values (
			#{email},
			#{password},
			#{lastName},
			#{firstName},
			concat(#{lastName},#{firstName}),
			#{gender},
			#{birthDate},
			#{phone},
			#{address}
		)
	]]>
	</insert>
	
	<select id="login" parameterType="user" resultType="user">
	<![CDATA[
		select USER_ID
			 , EMAIL
			 , FULL_NAME
			 , GENDER
			 , BIRTHDATE
			 , PHONE
			 , ADDRESS
			 , USER_ROLE
			from user
			where EMAIL = #{email}
			  and PASSWORD = #{password}
	]]>
	</select>
	
	<select id="findId" parameterType="user" resultType="user">
		<![CDATA[select * from user where FULL_NAME=#{fullName} and PHONE=#{phone}]]>
	</select>
	
	<select id="findPassword" parameterType="user" resultType="user">
		<![CDATA[select * from user where EMAIL=#{email} and FULL_NAME=#{fullName} and PHONE=#{phone}]]>
	</select>
	
	<update id="updateInfo" parameterType="user">
	<![CDATA[
		update user set 
			PASSWORD=#{password}, 
			LAST_NAME=#{lastName}, 
			FIRST_NAME=#{firstName},
			FULL_NAME=CONCAT(#{lastName}, #{firstName}),
			BIRTHDATE=#{birthDate},
			PHONE=#{phone},
			ADDRESS=#{address}
		where USER_ID=#{userId}
				
	]]>
	</update>
	
	<delete id="quit" parameterType="user">
		<![CDATA[delete from user where USER_ID=#{userId}]]>
	</delete>
	
	<select id="getUserInfo" parameterType="user" resultType="user">
	<![CDATA[
		select USER_ID
			 , EMAIL
			 , FULL_NAME
			 , GENDER
			 , BIRTHDATE
			 , PHONE
			 , ADDRESS
			 , USER_ROLE
			from user
			where USER_ID = #{userId}
	]]>
	</select>
	
	<select id="currentPwdCheck" parameterType="string" resultType="int">
		select count(PASSWORD)
			from user
			where PASSWORD = #{password}
	</select>
	
</mapper>